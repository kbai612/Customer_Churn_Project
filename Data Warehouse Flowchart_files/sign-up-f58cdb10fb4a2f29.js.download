(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4928],{34561:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/auth/sign-up",function(){return n(76578)}])},52012:function(e,t,n){"use strict";n.d(t,{My:function(){return h},Qb:function(){return v},p9:function(){return g}});var r=n(98788),i=n(22970),a=n(5632),o=n.n(a),u=n(42541),s=n(90581),c=n(99669),l={defaultTTL:86400},f=new(function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:l;(0,s.Z)(this,e),this._storage=t,this._options=n}var t=e.prototype;return t.setItem=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this._options.defaultTTL,r=Math.floor(Date.now()/1e3);this._storage.setItem(e,{value:t,exp:r+n})},t.getItem=function(e){var t=this._storage.getItem(e);if(null==t||"object"!=typeof t)return t;if(!Reflect.has(t,"value")||!Reflect.has(t,"exp"))return console.warn('ExpiryLocalStorage.getItem("'.concat(e,'") - data is malformed'),t),null;var n=Math.floor(Date.now()/1e3);return n>t.exp?(console.debug('ExpiryLocalStorage.getItem("'.concat(e,'") - data has expired ').concat(n-t.exp," seconds ago")),this._storage.removeItem(e),null):t.value},t.removeItem=function(e){this._storage.removeItem(e)},t.clear=function(){this._storage.clear()},e}())(c.J),p="auth/redirect";function d(e){return!(!e.startsWith("/")||e.includes("/../")||e.includes("/./")||e.includes("//"))}function g(e){if(!d(e))return void console.warn("Invalid redirect path attempted: ".concat(e));var t=e.replace(/[<>"']/g,"").replace(/javascript:/gi,"").replace(/data:/gi,"");f.setItem(p,t,900)}function h(){var e=f.getItem(p);return"string"!=typeof e?null:d(e)?e:(console.warn("Invalid redirect path found in storage: ".concat(e)),m(),null)}function m(){f.removeItem(p)}function v(e,t){return _.apply(this,arguments)}function _(){return(_=(0,r.Z)(function(e,t){var n;return(0,i.__generator)(this,function(r){switch(r.label){case 0:if(n=h(),console.debug("Redirect to ".concat(null!=n?n:e)),!(n&&d(n)))return[3,2];return m(),u.Z.trackEvent("login-page","redirect_to_saved_path",{source:t,url:n,workspaceId:n.split("/")[2]}),[4,o().replace(n)];case 1:return r.sent(),[3,4];case 2:return[4,o().replace(e)];case 3:r.sent(),r.label=4;case 4:return[2]}})})).apply(this,arguments)}},69857:function(e,t,n){"use strict";n.d(t,{i:function(){return b}});var r=n(98788),i=n(22970),a=n(5632),o=n.n(a),u=n(2784),s=n(69904),c=n(57685),l=n(45403),f=n(57821),p=["website","notion","integration","diagramgpt","chatgpt","sourcegraph-cody","git-diagrammer","product-hunt"],d=n(89960),g=n(88218),h=n(61490),m=n(57335),v=n(66140),_=n(52012),y=n(28055),w=function(e){o().replace(e)};function b(){var e,t=(0,c.K)(),n=(0,l.Pe)(),a=(0,u.useState)(),b=a[0],I=a[1],A=(0,u.useState)({}),T=A[0],N=A[1];(0,s.Z)(function(){var e=o().query.redirect;"string"==typeof e&&(console.info("[Auth Page] Saving redirect path",e),(0,_.p9)(e))}),(0,u.useEffect)(function(){N(function(e){var t=e.ref,n=e.utm_campaign,r=e.templateId,i=e.page;return n?{signUpOrigin:"paid",signUpCampaign:n}:r?{signUpOrigin:"website",signUpTemplate:r}:{signUpOrigin:"string"==typeof t&&p.includes(t)?t:"other",signUpPage:null!=i?i:""}}(t))},[t]),(0,u.useEffect)(function(){o().prefetch("/dashboard/all"),o().prefetch("/team/create"),o().prefetch("/team/join"),o().prefetch("/new"),v.cm.isSingleTenant||o().prefetch("/user/survey")},[]);var U=(0,u.useCallback)(function(){o().query.redirect_uri===m.NOTION_INTEGRATION_REDIRECT_URL&&o().replace("/notion/auth?"+new URLSearchParams(o().query).toString())},[]),E=(0,u.useCallback)(function(e){console.info("[Auth Page] Something went wrong",e),(0,d.Tb)(e),I(e)},[]),R=(0,u.useCallback)((e=(0,r.Z)(function(e){var t,r,a,u,s;return(0,i.__generator)(this,function(i){switch(i.label){case 0:return i.trys.push([0,4,,5]),console.info("[Auth Page] User signed in:",{id:e.id,email:e.email,isAnonymous:e.isAnonymous,displayName:e.displayName}),U(),[4,(0,h.backOffRetry)(function(){return n.userTeams.doesUserHaveTeam(e.id)})];case 1:if(t=i.sent(),r=[],!(!t&&e.email&&e.emailVerified))return[3,3];return a=(0,g.ZP)(e.email),[4,(0,h.backOffRetry)(function(){return n.teams.listByDomain(a)})];case 2:r=i.sent(),i.label=3;case 3:return t?(console.info("[Auth Page] User has team, redirect to ..."),s=(null==(u=o().asPath)?void 0:u.match("sign-up"))?"sign-up":"sign-in",(0,_.Qb)("/dashboard/all",s)):(console.info("[Auth Page] User has ".concat(r.length," teams with the same domain")),r.length>0?w("/team/join"):w("/team/create")),[3,5];case 4:return E(i.sent()),[3,5];case 5:return[2]}})}),function(t){return e.apply(this,arguments)}),[U,E]),S=(0,u.useCallback)(function(e){var t=(null==e?void 0:e.isAnonymous)?"Anonymous user signed in":"User signed out";console.info("[Auth Page] ".concat(t),{id:null==e?void 0:e.id,email:null==e?void 0:e.email,displayName:null==e?void 0:e.displayName}),(0,f.hf)()},[]);return(0,u.useEffect)(function(){var e=function(e){e&&!e.isAnonymous?R(e):S(e||null)},t=n.currentUser.getAuthUser();return t&&e(t),n.currentUser.on(y.S.AuthUserChanged,e),function(){n.currentUser.off(y.S.AuthUserChanged,e)}},[R,S]),{error:b,profileArgs:T}}},76578:function(e,t,n){"use strict";n.r(t),n.d(t,{__N_SSG:function(){return f}});var r=n(52322),i=n(2784),a=n(5632),o=n(24179),u=n(58410),s=n(69857),c=n(66140),l=n(69023),f=!0;t.default=function(){var e=(0,s.i)(),t=e.error,n=e.profileArgs,f=(0,a.useRouter)();return((0,i.useEffect)(function(){c.cm.isSingleTenant||f.prefetch("/user/survey"),f.prefetch("/team/create"),f.prefetch("/team/join")},[]),t)?(0,r.jsx)(u.Z,{statusCode:500,title:"Something went wrong"}):(0,r.jsx)(l.Z,{staticLogo:!0,children:(0,r.jsx)(o.Z,{profileArgs:n})})}},57335:function(e,t,n){"use strict";n.r(t),n.d(t,{NOTION_INTEGRATION_REDIRECT_URL:function(){return f},default:function(){return p}});var r=n(52322),i=n(2784),a=n(37164),o=n(5632),u=n(58410),s=n(96933),c=n(67640),l=n(89960),f="https://www.notion.so/externalintegrationauthcallback",p=function(){var e=(0,o.useRouter)(),t=(0,s.fC)(),n=e.query.code,f=e.query.redirect_uri,p=e.query.state;return((0,i.useEffect)(function(){if(t&&n){if(null==t?void 0:t.isAnonymous)return void e.replace("/auth/sign-up?ref=notion&"+new URLSearchParams(e.query).toString());var r,i=(0,a.x0)();(r={notionAuthCode:n,tempAuthCode:i,userEmail:t.email,userDisplayName:t.displayName},c.Z.post("notion/retrieveToken",r,{responseType:"text"})).then(function(e){null==e?location.replace(f+"?error=access_denied&error_description=Not+valid+access+token.."):location.replace(f+"?code=".concat(i,"&state=").concat(p))}).catch(function(e){(0,l.Tb)(e),location.replace(f+"?error=access_denied&error_description=An+internal+server+error+occurred.")})}},[t,n,p,f,e]),f&&n&&p)?null:(0,r.jsx)(u.Z,{statusCode:400,title:"Not enough query parameters specified"})}}},function(e){e.O(0,[2888],function(){return e(e.s=34561)}),_N_E=e.O()}]);